{% extends 'base.html' %}

{% block title %}{{ profile_user.username }}'s Profile - Social Platform{% endblock %}

{% block content %}
<div class="profile-header">
    <h2>{{ profile_user.username }}'s Profile</h2>
    <div class="profile-stats">
        <span>Posts: {{ posts.count }}</span>
        <span>Followers: {{ followers_count }}</span>
        <span>Following: {{ following_count }}</span>
    </div>
    
    {% if user.is_authenticated and user != profile_user %}
    <form method="post" action="{% url 'follow_user' profile_user.username %}">
        {% csrf_token %}
        <button type="submit" class="follow-btn">
            {% if is_following %}Unfollow{% else %}Follow{% endif %}
        </button>
    </form>
    {% endif %}
</div>

<!-- Create Post Form (only if viewing own profile) -->
{% if user == profile_user %}
<div class="create-post">
    <form method="post" action="{% url 'create_post' %}">
        {% csrf_token %}
        <textarea name="content" placeholder="What's on your mind?" required></textarea>
        <button type="submit">Post</button>
    </form>
</div>
{% endif %}

<!-- User's Posts -->
<div class="posts">
    {% for post in posts %}
    <div class="post">
        <div class="post-header">
            <strong>{{ post.user.username }}</strong>
            <span class="post-time">{{ post.created_at|timesince }} ago</span>
        </div>
        <div class="post-content">
            {{ post.content }}
        </div>
        <div class="post-actions">
            <button class="like-btn" data-post-id="{{ post.id }}">
                {% if request.user in post.like_set.all %}
                    ‚ù§Ô∏è Liked
                {% else %}
                    ü§ç Like
                {% endif %}
                (<span class="likes-count">{{ post.likes_count }}</span>)
            </button>
            
            <form method="post" action="{% url 'add_comment' post.id %}" class="comment-form">
                {% csrf_token %}
                <input type="text" name="content" placeholder="Add a comment..." required>
                <button type="submit">Comment</button>
            </form>
        </div>
        
        <!-- Comments -->
        <div class="comments">
            {% for comment in post.comments.all|slice:":3" %}
            <div class="comment">
                <strong>{{ comment.user.username }}:</strong> {{ comment.content }}
                <small>{{ comment.created_at|timesince }} ago</small>
            </div>
            {% endfor %}
        </div>
    </div>
    {% empty %}
    <p>No posts yet.</p>
    {% endfor %}
</div>
{% endblock %}
