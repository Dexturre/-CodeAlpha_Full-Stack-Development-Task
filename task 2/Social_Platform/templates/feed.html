{% extends 'base.html' %}

{% block title %}Feed - Social Platform{% endblock %}

{% block content %}
<h2>Your Feed</h2>

<!-- Create Post Form -->
<div class="create-post">
    <form method="post" action="{% url 'create_post' %}">
        {% csrf_token %}
        <textarea name="content" placeholder="What's on your mind?" required></textarea>
        <button type="submit">Post</button>
    </form>
</div>

<!-- Posts Feed -->
<div class="posts">
    {% for post in posts %}
    <div class="post">
        <div class="post-header">
            <a href="{% url 'profile' post.user.username %}">
                <strong>{{ post.user.username }}</strong>
            </a>
            <span class="post-time">{{ post.created_at|timesince }} ago</span>
        </div>
        <div class="post-content">
            {{ post.content }}
        </div>
        <div class="post-actions">
            <button class="like-btn" data-post-id="{{ post.id }}">
                {% if request.user in post.like_set.all %}
                    ‚ù§Ô∏è Liked
                {% else %}
                    ü§ç Like
                {% endif %}
                (<span class="likes-count">{{ post.likes_count }}</span>)
            </button>
            
            <form method="post" action="{% url 'add_comment' post.id %}" class="comment-form">
                {% csrf_token %}
                <input type="text" name="content" placeholder="Add a comment..." required>
                <button type="submit">Comment</button>
            </form>
        </div>
        
        <!-- Comments -->
        <div class="comments">
            {% for comment in post.comments.all|slice:":3" %}
            <div class="comment">
                <strong>{{ comment.user.username }}:</strong> {{ comment.content }}
                <small>{{ comment.created_at|timesince }} ago</small>
            </div>
            {% endfor %}
        </div>
    </div>
    {% empty %}
    <p>No posts yet. Follow some users to see their posts!</p>
    {% endfor %}
</div>
{% endblock %}
